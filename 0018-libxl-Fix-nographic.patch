From 43cc7728c6ba6fb54d63f15a13cb54f504a032f1 Mon Sep 17 00:00:00 2001
From: Artur Puzio <contact@puzio.waw.pl>
Date: Wed, 29 Apr 2020 15:26:16 +0200
Subject: [PATCH 2/2] libxl: Fix nographic

---
 src/libxl/libxl_conf.c                               | 1 +
 tests/libxlxml2domconfigdata/fullvirt-acpi-slic.json | 3 +++
 tests/libxlxml2domconfigdata/fullvirt-cpuid.json     | 3 +++
 3 files changed, 7 insertions(+)

diff --git a/src/libxl/libxl_conf.c b/src/libxl/libxl_conf.c
index a5605f6200..d17782b650 100644
--- a/src/libxl/libxl_conf.c
+++ b/src/libxl/libxl_conf.c
@@ -2417,6 +2417,7 @@ libxlMakeVideo(virDomainDefPtr def, libxl_domain_config *d_config)
         b_info->video_memkb = def->videos[0]->vram;
     } else {
         libxl_defbool_set(&b_info->u.hvm.nographic, 1);
+        b_info->u.hvm.vga.kind = LIBXL_VGA_INTERFACE_TYPE_NONE;
     }
 
     return 0;
diff --git a/tests/libxlxml2domconfigdata/fullvirt-acpi-slic.json b/tests/libxlxml2domconfigdata/fullvirt-acpi-slic.json
index e804389fea..f16b4a971a 100644
--- a/tests/libxlxml2domconfigdata/fullvirt-acpi-slic.json
+++ b/tests/libxlxml2domconfigdata/fullvirt-acpi-slic.json
@@ -20,6 +20,9 @@
             "acpi": "True",
             "acpi_firmware": "/path/to/slic.dat",
             "nographic": "True",
+            "vga": {
+                "kind": "none"
+            },
             "vnc": {
                 "enable": "False"
             },
diff --git a/tests/libxlxml2domconfigdata/fullvirt-cpuid.json b/tests/libxlxml2domconfigdata/fullvirt-cpuid.json
index d46b464642..ddc423bca7 100644
--- a/tests/libxlxml2domconfigdata/fullvirt-cpuid.json
+++ b/tests/libxlxml2domconfigdata/fullvirt-cpuid.json
@@ -27,6 +27,9 @@
             "apic": "True",
             "acpi": "True",
             "nographic": "True",
+            "vga": {
+                "kind": "none"
+            },
             "vnc": {
                 "enable": "False"
             },
-- 
2.26.2

